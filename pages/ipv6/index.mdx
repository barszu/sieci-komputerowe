import { Steps } from 'nextra/components'
import { Details } from '../../components/details'

# IPv6 vs IPv4

IPv4 dobrze sÅ‚uÅ¼yÅ‚ przez wiele lat, ale IPv6 rozwiÄ…zuje jego ograniczenia, szczegÃ³lnie wyczerpanie przestrzeni adresowej. PrzejÅ›cie na IPv6 jest konieczne dla dalszego rozwoju internetu.

IPv6 wymaga ICMPv6 do dziaÅ‚ania:

- NDP (Neighbor Discovery Protocol) - zamiast ARP, ICMP Router Discovery i ICMP Redirect (jak w IPv4)
  - NS (Neighbor Solicitation) - odkrywanie sÄ…siadÃ³w
    > NA (Neighbor Advertisement) - odpowiedÅº na NS
  - RS (Router Solicitation) - pytanie konfiguracyjne o routery
    > RA (Router Advertisement) - odpowiedÅº na RS
- SLAAC (Stateless Address Autoconfiguration) - zamiast DHCP, ale moÅ¼na uÅ¼ywaÄ‡ DHCPv6

![IPv6 vs IPv4](/ipv6/img/img4.jpg)

| Cecha                   | IPv4                                            | IPv6                                                                                                                                                                   |
| ----------------------- | ----------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **DÅ‚ugoÅ›Ä‡ adresu**      | 32-bitowy                                       | 128-bitowy                                                                                                                                                             |
| **IloÅ›Ä‡ adresÃ³w**       | 2^32 = 4,3 miliarda                             | 2^128 = 4,3 miliarda \* 2^96                                                                                                                                           |
| **Format adresu**       | DziesiÄ™tny, cztery pola po 8 bitÃ³w (oktet)      | Szesnastkowy, osiem pÃ³l po 16 bitÃ³w (hexet)                                                                                                                            |
| **PrzykÅ‚ad**            | 192.168.0.1                                     | 2001:0db8:0000:0000:0000:0000:0000:0001 = 2001:0db8::1 <br/> <br/> PodwÃ³jne dwukropki mogÄ… byÄ‡ uÅ¼yte tylko raz w adresie IPv6, aby zastÄ…piÄ‡ jednÄ… lub wiÄ™cej grup zer. |
| **Konfiguracja adresu** | RÄ™czna lub przez DHCP                           | Autokonfiguracja (SLAAC) i DHCPv6                                                                                                                                      |
| **Fragmentacja**        | Routery i hosty mogÄ… fragmentowaÄ‡ pakiety       | Tylko hosty mogÄ… fragmentowaÄ‡ pakiety, <br/> `brak fragmentowania po drodze`                                                                                           |
| **Broadcast**           | ğŸ‘                                              | âŒ ZastÄ…piony przez multicast i anycast                                                                                                                                |
| **BezpieczeÅ„stwo**      | Opcjonalne, przez dodatkowe protokoÅ‚y jak IPsec | Wbudowane IPsec                                                                                                                                                        |
| **UnikalnoÅ›Ä‡**          | Lokalne âŒ <br/> Globalne ğŸ‘                    | ğŸ‘ kaÅ¼dy unikalny jak MAC (w teori)                                                                                                                                    |
| **PrzejÅ›cie**           | Obecny standard, ale adresy siÄ™ koÅ„czÄ…          | Zaprojektowany jako nastÄ™pca IPv4, mechanizmy przejÅ›ciowe (dual-stack, tunelowanie)                                                                                    |

## Fragmentacja

- wysyÅ‚ajÄ…cy host musi znaÄ‡ MTU Å›cieÅ¼ki przed wysÅ‚aniem
- moÅ¼na tunelowaÄ‡, czyli pakowaÄ‡ IPv6 do pakietÃ³w IPv4 i tak wysyÅ‚aÄ‡
- fragmentacja zachodzi poprzez uÅ¼ycie extension headera â€œFragmentation headerâ€
- kolejne fragmenty dostajÄ… wÅ‚asne bazowe nagÅ‚Ã³wki

## ZÅ‚oÅ¼onoÅ›Ä‡ nagÅ‚Ã³wka

- IPv4: 20-60 bajtÃ³w, wiele pÃ³l opcji i flag
- IPv6: 40 bajtÃ³w, uproszczony

![IPv6 Header](/ipv6/img/img1.jpg)

<Details summary='co robi kaÅ¼de pole?'>
<Steps>
### Version [4 bit]

> wersja protokoÅ‚u, Ipv6 = 6

### Traffic Class [8 bit]

> priorytet pakietu, jakoÅ›Ä‡ usÅ‚ugi

- 3 bity priorytetu (Quality of Service)

  - im wyÅ¼sza wartoÅ›Ä‡, tym waÅ¼niejszy pakiet
  - jeÅ¼eli router musi odrzuciÄ‡ pakiety, to odrzuci te o niÅ¼szym priorytecie

- 4 bity DSCP (Differentiated Services Code Point)

  - okreÅ›la sposÃ³b obsÅ‚ugi pakietu przez routery
  - np. VoIP ma wyÅ¼szy priorytet niÅ¼ e-mail

- 1 bit ECN (Explicit Congestion Notification)
  - informuje o przeciÄ…Å¼eniu sieci

### Flow Label [20 bit]

> identyfikator przepÅ‚ywu, np. dla pakietÃ³w VoIP

- routery mogÄ… zapamiÄ™taÄ‡ przepÅ‚yw i obsÅ‚ugiwaÄ‡ go szybciej

### Payload Length [16 bit]

> dÅ‚ugoÅ›Ä‡ caÅ‚ego pakietu po tym nagÅ‚Ã³wku - zarÃ³wno danych, jak i kolejnych nagÅ‚Ã³wkÃ³w IPv6

### Next Header [8 bit]

> typ nagÅ‚Ã³wka nastÄ™pnego po nagÅ‚Ã³wku IPv6. MoÅ¼e to byÄ‡ nagÅ‚Ã³wek TCP, UDP, ICMPv6, itp.

- coÅ› jak opcje w IPv4
- nagÅ‚Ã³wek warstwy 4 (TCP = 6, UDP = 17)
- pola te zwykle przetwarzane sÄ… dopiero u odbiorcy

### Hop Limit [8 bit]

> maksymalna liczba skokÃ³w

- coÅ› jak TTL w IPv4
- jeÅ¼eli docelowy host bÄ™dzie miaÅ‚ **Hop Limit = 0**, to **przetworzy pakiet**, a nie odrzuci go

</Steps>
</Details>

## Anycast

> zamiast broadcastu

> rodzaj wysyÅ‚ania pakietu typu â€œtraf gdziekolwiekâ€, ale trafiajÄ… do najbliÅ¼szego hosta z punktu widzenia routingu

dziaÅ‚a jak numer alarmowy 112 - gdziekolwiek sie znajdujemy to poÅ‚Ä…czymy siÄ™ z najbliÅ¼szym centrum alarmowym

## Autokonfiguracja

![Autokonfiguracja](/ipv6/img/img12.jpg)
![Autokonfiguracja](/ipv6/img/img13.jpg)
![Autokonfiguracja](/ipv6/img/img14.jpg)
![Autokonfiguracja](/ipv6/img/img15.jpg)

### SLAAC (Stateless Address Autoconfiguration)

- routery rozgÅ‚aszajÄ… prefix sieci, trasÄ™ domyÅ›lnÄ… i MTU
- adres link-local - FE:80::/10, nie forwardowany poza Å‚Ä…cze
- host robi tymczasowy adres IP, sklejajÄ…c adres link-local i swÃ³j MAC i wysyÅ‚a multicast, chcÄ…c dostaÄ‡ informacje od routera
- potem uÅ¼ywa adresu: prefix sieci + wÅ‚asny MAC
- w razie potrzeby moÅ¼na uÅ¼ywaÄ‡ adresu z link-local

### stateful - uÅ¼ywa DHCPv6

> host multicastem zgÅ‚asza siÄ™ do serwera (serwerÃ³w) DHCP i dostaje informacje

## RozwiÄ…zania przejÅ›ciowe

### Dual-stack

> urzÄ…dzenia majÄ… adres IPv4 i IPv6 jednoczeÅ›nie

- ktÃ³ry protokÃ³Å‚ uÅ¼yÄ‡ zaleÅ¼y od aplikacji

### Tunneling

> pakowanie pakietu IPv6 w pakiet IPv4

- urzÄ…dzenia obsÅ‚ugujÄ…ce IPv4 nie sÄ… Å›wiadome ze w polu dane jest IPv6
- adres docelowy IPv4 to adres koÅ„ca tunelu (np. routera po drodze z sieci WAN)
- adres ÅºrÃ³dÅ‚owy IPv4 to adres routera, ktÃ³ry pakuje pakiet

![Tunneling](/ipv6/img/img18.jpg)

<Steps>

#### statyczny tunel - punkt-punt

- rÄ™cznie konfigurowany

#### dynamiczny tunel - punkt-wielopunkt

- automatycznie konfigurowany
- wykorzystuje siÄ™ adresy pÄ™tli zwrotnych routerÃ³w, ktÃ³re konfigurowane sÄ… podczas zestawiania tunelu

Metody:

- **6to4** - z adresami 2002::/16 lub unikatowych adresÃ³w globalnych
- **ISATAP** - z tylko adresÃ³w globalnych

</Steps>

### NAT-PT

> Network Address Translation - Protocol Translation

adres IPv6 jest przetÅ‚umaczony na adres IPv4 i odwrotnie (tak jak w NAT)
