# Zadania wartswy łącza danych modelu OSI/ISO

- `wrapuje pakiet w adres MAC wysyłającego i odbiorcy`
- `tworzy sie z tego ramka`
- `wykrywa bledy` -> ramke co otrzymalem nie moge dekapsulowac bo są glupoty

[wiecej o tym w... (poczatek)](./lab2_koncentrat2.md)

# Działanie protokołu CSMA/CD

> Carier Sence Multiple Access with Colision Detection

- `wykrywanie kolizji`
- `nie deterministyczny`
- tylko dla `half duplex` - tam gdzie kolizje

[wiecej o tym w...](./lab2_koncentrat.md)

![img12](/lab2/img/img12.webp)

# Standardy Ethernet

[wiecej o tym w... (linia 90)](./lab2_koncentrat2.md)

Problemy zwiekszania szybkości -> przesył jest za szybki i `IFG` jest za krótki, solution:

- masywniejsza ramka (klejenie ich ze soba)
- krótsza siec poprostu

## Fast Ethernet (100 Mb/s)

- 10x większa prędkość przesyłania danych -> 10x krótszy czas wysyłania ramki -> rozległość ramki podczas transmisji jest 10x mniejsza
- max rozległość sieci **200m**
- szczelina czasowa to **512 bitów**

## Gigabit Ethernet (1Gb/s)

- w ramce znajduje się wypełniacz wydłuża czas zajmowany przez ramke do **512 bajtów** (ramka ma dalej minimalnie 64 bity)
- **frame bursting** - gdy ma do wysłania wiele ramek klei je ze sobą i wysyla , mniej jest wypelniacza, max 8k bajtów
- tylko `full duplex` wtedy **CSMA/CD nie używa** się

  - CS (Carrier Sense) - stacje nie muszą badać, czy medium jest wolne, bo zawsze jest
  - MA (Multiple Access) - każda stacja ma swoje medium
  - CD (Collision Detection) - nie ma kolizji do wykrywania

  > fullduplex jest tylko peer-peer (debil:punkt-punkt) na kiekolidujacym kablu

- albo światłowody albo skrętki **(kat. >= 5)**

![img13](/lab2/img/img13.webp)

# Ramka Ethernet

![img11](/lab2/img/img11.webp)
[wiecej o tym w... (koniec)](./lab2_koncentrat2.md)

Preambuła i znacznik poczatki ramki leci najpierw ('hej zaraz dostaniesz paczke') reszta pozniej

# Szczelina Czasowa

> okresla ile czasu zajmie aby wysłać ramke o min rozmiarze

- jednostka bit time `[bt]` lub byte time `[Bt]` lub `[s]`
- na tyle duża aby możliwe było wykrycie że 2 stacje nadają (zanim skończą), (żeby każdy komp to wiedział)
- czas tworzenia pojedynczej szczeliny to slot time
- czas na **wysłanie** ramki **> 1 ST**
- czas na **poinformowanie o kolizji** **< 1 ST**
- określa maksymalną rozległość fizycznego segmentu sieci

# Minimalny rozmiar ramki:

> czas wysłania ramki musi być na tyle duży, żeby w tym czasie dało się stwierdzić czy następuje kolizja i poinformować o tym nadawców

> **RTT** - round trip time - (pełna droga ramki tam i z powrotem)

- w najgorszym przypadku host potrzebuje == RTT czasu na dowiedzenie się o transmisji, więc min rozmiar ramki trzeba tak skorelować z
  RTT i rozległością sieci, żeby **czas przesłania całej ramki był < RTT**
- ramka na tyle duża, żeby jej początek dotarł do wszystkich, skończy się nadawanie
- **czas wysyłania == szczelina czasowa**
- bierze pod uwagę:
  - RTT
  - opóźnienia w przetwarzaniu informacji
  - skończona szybkość propagacji sygnału (ok. 2/3 prędkości światła)
- wartości:
  - Ethernet, Fast Ethernet: 64 B
  - Gigabit Ethernet: 512 B

# Rozległość fizycznego segmentu sieci:

> wpływa na to minimalny rozmiar ramki i wielkość szczeliny czasowej

> **max rozległość = prędkość propagacji \* (wielkość szczeliny czasowej / 2)**
>
> _propagacja == często 2/3 c_

- wynika z ograniczeń nakładanych przez CSMA/CD
- zależy od Ethernet, Fast Ethernet, Gigabit Ethernet

# Adresacja MAC

[wiecej o tym w... (linia 37)](../lab1/lab1_koncentrat.md)

3 starsze bajty (po lewej):

- **OUI** (Organizacyjnie Unikalny Identyfikator) - przydzielany producentowi przez IEEE
- Jeśli drugi najmłodszy bit najstarszego bajtu (bit 2) jest ustawiony na 1, to adres MAC jest zarządzany lokalnie przez administratora (jak są kolizje to jego wina)

3 młodsze bajty (po prawej):

- unikalne dla urządzenia (Network Interface Controller specific)
- producent / administrator sieci ustala, jak chce

# NIC - Network Interface Card - karta sieciowa

> urządzenie pracujące w I,II warstwie modelu OSI / ISO

- zapewnia dostęp do medium w określonym standardzie
- formatuje ramki, obsługuje określony protokół warstwy łącza danych
- ma adres MAC (najczęściej niezmienny), ale można zmienić na systemie operacyjnym

## Jak NIC odbiera ramkę?

na podstawie adresu docelowego decyduje czy bierze czy nie bierze.

Odbiera gdy: adres przeznaczenia

- == własnemu adresowi MAC
- == adresem rozgłoszeniowym
- należy do zbioru adresów grupowych, którymi stacja jestzainteresowana

Decyzja jest podejmowana po:

- po przeczytaniu całej ramki i sprawdzeniu sumy kontrolnej
- (bridge) po przeczytaniu adresu docelowego

# Rodzaje transmisji

- w żadnym przypadku nie ma gwarancji, że informacja trafi tylko do zaadresowanego urządzenia!
- Adres mówi tylko o tym, czy urządzenie powinno się zainteresować informacją

- na współczesnym sprzęcie switche interpretują ramki, żeby powyższe nie zachodziło, ale sam Ethernet niczego nie gwarantuje

## Transmisja broadcast - do wszystkich

- wszyscy otrzymują czy chcą czy nie
- granica router (dalej nie pojdzie), router router moze miec broadcast!
- **domena rozgłoszeniowa** - wszedzie tam gdzie broadcast dojdzie
- **MAC - hex same F** binarnie same 1
- uzywane do szukania kto czai sie pod IP (jego MAC'a)

## Transmicja multicast - do grupy

- tutaj **grupa == jeden special receiver**
- odbiorcy wyznaczani przez specjalny komunikat dołączenia do danej grupy multicastowej
- (prawy bit z bajtu najbardziej na lewo) to 1 | **najstarszy bajt jest nieparzysty**
- wybór powyższego: pozwala interfejsowi od razu przygotować się do obsługi takiej ramki

## Transmisja unicast - do konkretnego

- tylko wszystkie adresy -- specjalne
- **nie ma gwarancji** ze dotrze do niego

# Tryb promiscuous

- urządzenie przechwytuje i analizuje wszystkie pakiety danych przechodzące przez sieć, niezależnie od tego, do kogo są one adresowane
- tryb interfejsu sieciowego (wykorzystywany przez mostki i sniffery) , w którym urządzenie **przekazuje dalej** wszystkie ramki do przetwarzania.
- przetwarza on tylko ramki unicast do siebie, multicast do własnych grup i broadcast
- `nie routerr!!!`

# Urządzenie Sniffer

> urządzenie/oprogramowanie (np. whireshark) któro przechwytuje i analizuje ruch sieciowy

Zastosowanie -> narzędzia diagnostyczne, monitorujące lub do naruszania prywatności

## zabezpieczanie się

- Wyeliminowanie z sieci hubów i repeaterów.
- Podział sieci na małe sieci wirtualne (VLAN), bo chociaż fizycznie są połączone, to na poziomie warstwy drugiej (logicznie) są wtedy odseparowane.
- Użycie szyfrowania na wyższych warstwach sieci.
- Użycie “inteligentnego” sprzętu (np. zarządzalne switche), które wykrywają i reagują na próby podsłuchiwania lub blokują je (np. blokują komunikację dowolnych dwóch urządzeń niebędących częścią infrastruktury sieci).

# Domena kolizyjna

> część sieci, gdzie transmitować może tylko jedno urządzenie naraz.

> Granicę wyznaczają mostki, switche i routery

# Domena rozgłoszeniowa

> część sieci, gdzie docierają broadcasty

> Granicę wyznaczają routery i sieci wirtualne VLAN.

# Podział domen z użyciem wartswy I (fizycznej) [`hub`]

- **bez sensu** bo nic nie daje
- rośnie domena kolizyjna, bo **hub przekazuje dalej sygnal elektryczny i to na wszytskie swoje porty**
- `domena kolizyjna == domena rozgłoszeniowa`

![img14](/lab2/img/img14.webp)

> zastosowanie wartswy: pozwalają **zwiększyć rozległość sieci**

# Podział domen z użyciem wartswy II (łącza danych) [`switch / mostek`]

- rozszerza domene rozgloszeniowa, (domyślnie, można zrobić VLANy )
- można poodzielać domeny kolizyjne od siebie

![img15](/lab2/img/img15.webp)

> zastosowanie wartswy:
>
> - mają zalety repeaterów
> - zmniejszają ruch w sieci poprzez **filtrację ramek**
> - separują tylko domeny kolizyjne

# Podział domen z użyciem wartswy III (sieciowa) [`router`]

- oddziela domeny rozgloszeniowe i kolizyjne od siebie - zastosowanie warstwy

![img16](/lab2/img/img16.webp)

# Zasada działania urządzenia hub

- z warstwy I - **fizycznej**
- nie-inteligente urządzenie, **powiela sygnał elektryczny** z wejścia na **wszystkie wyjścia**
  - **powiększa domenę kolizyjną**
  - **może przesłać szum**, cokolwiek - bo nie jest inteligente

![skurwol](/lab2/img/skurwol.webp)

# Przeźroczyste urządzenia warstwy II - łącza danych

- mostki i switche
- "przeźroczyste" - ich **obecność jest niewidoczna dla urządzeń końcowych** w sieci (nie sa ich swiadome).
- **Widoczność fizyczna, nie logiczna**: Urządzenia te są widoczne w fizycznej topologii sieci, ale nie są widoczne w jej logicznej strukturze.
- **Mostki**: Łączą dwa lub więcej segmentów sieci, filtrując ruch i zmniejszając kolizje. Przekazują ramki tylko wtedy, gdy jest to konieczne.
- **Switche**: Działają podobnie do mostków, ale z większą liczbą portów. Przekazują ramki na podstawie adresów MAC, co zwiększa efektywność sieci i zmniejsza kolizje.

## Mostki i Switche

- **oszczędniejsze wysyłanie**: Wysyłanie unicastów i multicastów tylko tam, gdzie trzeba, a **nie wszędzie**.
- **Nauka budowy sieci**: Uczą się, gdzie są odbiorcy wiadomości (adresów MAC) dla zwiększania wydajności:
- **`Zmniejszanie domeny kolizyjnej`**: dzieląc sieć na fragmenty, jednocześnie nie naruszając domeny rozgłoszeniowej (broadcasty mają lecieć wszędzie).
- **`Tryb promiscuous`**: Switche/mostki działają w trybie promiscuous (nasluchu i analizy całego ruchu),
- **`Tablica forwardingu` (FDB)**: Dla każdej ramki odczytują MAC nadawcy i zapisują w tablicy forwardingu (sprzętowo realizowany hash table -> pamięć CAM), że dany MAC widziano na określonym porcie (lub aktualizują istniejącą informację).
- **Czas ważności wpisów**: przy braku ruchu i upływie czasu usuwa się stare wpisy.

### Przy nowej ramce (wszystkie porty poza tym, z którego przyszła wiadomość):

- **Broadcast**: Wysyła ramkę na wszystkie porty.
- **Multicast**:
  - Przy prostych switchach jak broadcast.
  - Przy lepszych: Podłączone hosty wysyłają najpierw komunikat protokołu IGMP o chęci dołączenia do transmisji, zapisują kto i na którym porcie jest zainteresowany grupą i przekazują multicasty tylko do odpowiednich hostów.

#### **Adresu `nie znaleziono` w tablicy forwardingu**:

- Ramka zostaje wysłana na wszystkie porty
- (odbiorca może się wtedy odezwać i można uzupełnić tabelę),
- dodajemy wpis do tablicy z adresem MAC i portem nadawcy.

#### **Adres znaleziono i `port odbiorcy = port nadawcy`**:

- Nie przekazuj dalej, bo ramka ma zostać w tym samym segmencie sieci
- _(switch prawdopodobnie dostał ramkę przez bezmyślnie przekazujący ją hub)_.

#### **Adres `znaleziono i ma inny port`**:

- Przekaż dalej na ten port,
- aktualizacja w tablicy czasu życia wpisu dla danego adresu MAC.

### MAC flooding - atak na tablicę forwardingu - zapelnienie jej

- atakujący komputer generuje dużo ramek z losowymi adresami źródłowymi -> zapełnia tablicę forwardingu, pamięc CAM.
- => buffer overflow exploit w switchu może być
- wymusza na switchu wysyłanie wszystkich wiadomości jak broadcastowych

## Sposoby przekazywania ramek

### `Store-and-Forward` - asymetryczn

- Może obsługiwać różne prędkości bitowe, tzn. odebrać całą ramkę z jedną prędkością, sprawdzić i nadać z inną (np. Ethernet -> Gigabit Ethernet)
- Wymaga buforowania pamięci
- Odbieramy ramkę, sprawdzamy sumę kontrolną, jeśli ok to zapamiętujemy adres nadawcy i decydujemy o jej losie
- **Zaleta:** wykrywa wszystkie błędne ramki
- **Wada:** wprowadza **największe opóźnienie**

### `Cut-Through` - symetryczne

- Port wyjściowy musi pracować z co najmniej taką samą prędkością, co wejściowy
- Decyzja o ramce jest podejmowana jeszcze przed otrzymaniem całej (zanim można w ogóle policzyć sumę kontrolną)
- **2 rozwiązania:**
  - **`Fast-Forward`:** decydujemy, jak dostaniemy ostatni bit adresu nadawcy (12 B); szybkie, ale może powodować problemy z kolizjami, przy full duplexie mamy gwarancję braku kolizji, więc można wykorzystywać szybsze fast-forward
  - **`Fragment-Free`:** decydujemy, jak odczytamy 64 B ramki (minimalny rozmiar), bo zgodnie z CSMA/CD wtedy na 100% już nie ma kolizji; wolniejsze, ale zapewnia brak kolizji, Przy half duplexie fragment-free jest bezpieczniejsze,

> **Alignment error** - błąd wyrównania, rozmiar ramki nie jest wielokrotnością 8 (**ramka nie składa się tylko z pełnych bajtów**).

> **`Mikrosegmentacja`** - technika w switchach, **1 port => 1 host**
