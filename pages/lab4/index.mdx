import { Steps } from 'nextra/components'
import { Details } from '../../components/details'
import { Callout } from 'nextra/components'

# STP - Spanning Tree Protocol

- protokoÅ‚ **warstwy drugiej** (Å‚Ä…cza danych) modelu OSI/ISO, ktÃ³ry zapewnia, Å¼e **nie ma pÄ™tli** (cyklu) w sieci
  - brak burzy broadcastowej
  - **sieÄ‡ nie umiera od krÄ…Å¼acych w nieskonczonosc ramek**
  - zapobiega powstawaniu pÄ™tli routingu
- **dziala na poziomie logicznym** wlaczajac/wylaczajac porty (kierujac ruchem)
- moÅ¼na mieÄ‡ dodatkowe 'zapasowe' poÅ‚Ä…czenia
- **przeÅºroczyste** dla innych urzÄ…dzeÅ„, (nie widzÄ…)

<Callout type="error" emoji="ğŸš¨">

W nowoczesnych implementacjach STP, tworzy siÄ™ **roÅ¼ne STP dla rÃ³Å¼nych VLANÃ³w**

</Callout>

## Wady

- nie ma dodatkowych poÅ‚Ä…czeÅ„ zwiÄ™kszajÄ…cych wydajnoÅ›Ä‡ (jedynie dezaktywowane zapasowe)
- spada przepustowoÅ›Ä‡ ^
- wymaga regularnego badania sieci (czy cos nie przestaÅ‚o dziaÅ‚aÄ‡, zostalo doÅ‚Ä…czone)
- duzy koszt przebudowania Spanning Tree, (kilkadziesiat sekund, < ~60s)
- nakÅ‚ada limit switchy - max 7 na gaÅ‚Ä…Åº
  - Å¼eby byÅ‚ czas przekazaÄ‡ ramki co `Hello Time`. 7 \* `2 s` (domyÅ›lny czas) = 14, wiÄ™c wiÄ™cej siÄ™ nie zmieÅ›ci.
  - JeÅ¼eli zmniejszy siÄ™ lub wydÅ‚uÅ¼y `Forward Delay`, to moÅ¼na odpowiednio zmieniÄ‡ Hello Time i liczbÄ™ switchy.

## DziaÅ‚anie

- wykorzystuje przesyÅ‚anie co regularny czas (domyÅ›lnie co **2 sekundy**) ramek `BPDU` (Bridge Protocol Data Unit)
- uÅ¼ywa specjalnego adresu multicastowego **01:80:C2:00:00:00**
- na szczycie grafu jest gÅ‚Ã³wny switch (`root`) zarzÄ…dzajÄ…cy siecia
- zostaje nim na podstawie indetyfikatora (z mniejsza wartoÅ›cia wygrywa)

## Zasady konfiguracji STP:

1. prawidÅ‚owe **ustawienie priorytetÃ³w**:
   - korzeniem powinno byÄ‡ urzÄ…dzenie z najwiÄ™kszÄ… iloÅ›ciÄ… ruchu (czyli â€œna Å›rodkuâ€ grafu), z podÅ‚Ä…czonymi kablami o wysokiej przepustowoÅ›ci
   - jeÅ¼eli rootem zostanie switch â€œna brzeguâ€ grafu, to Å¼eby dojÅ›Ä‡ do przeciwlegÅ‚ego koÅ„ca drzewa, ruch bÄ™dzie musiaÅ‚ iÅ›Ä‡ przez caÅ‚Ä… sieÄ‡
2. **zrÃ³Å¼nicowanie priorytetÃ³w**:
   - zabezpieczenie w przypadku awarii
   - jak korzeÅ„ padnie przez awariÄ™, to priorytety decydujÄ… o przejmowaniu roli korzenia; powinny byÄ‡ ukÅ‚adane w kolejnoÅ›ci zgodnie z zasadÄ… z punktu powyÅ¼ej
3. jak **nie trzeba STP, to nie uÅ¼ywajmy STP**:
   - zmniejsza wydajnoÅ›Ä‡ sieci, wymaga wysyÅ‚ania duÅ¼ej iloÅ›ci ramek BPDU
   - bez sensu jeÅ¼eli mamy sieÄ‡ bez redundantnych poÅ‚Ä…czeÅ„ (= drzewo rozpinajÄ…ce juÅ¼ dziÄ™ki kablom)
   - wymaga upewnienia siÄ™, Å¼e porty koÅ„cowe (tam, gdzie podÅ‚Ä…czamy komputery) sÄ… zabezpieczone przed utworzeniem cykli
